# コーディングルール

**USER'S CUSTOM INSTRUCTIONSを読むこと**

**IMPORTANTには最優先でしたがうこと。**
[IMPORTANT]: **手順にある「それを実際に発言する」をするときは、必ず【】で囲って発言すること**
[IMPORTANT]: **自分が守るべきルールについて【それを実際に発言すること】**

## コーディング手順

1. USER'S CUSTOM INSTRUCTIONSを確認して、このプロジェクトの設計思想を確認し、【それを実際に発言する】
2. コーディングガイドラインを再確認し、自分が守るべきルールについて【それを実際に発言する】
3. ユーザーが提示した設計書を確認する。もし見つからない場合は【それを実際に発言する】して、終了すること
4. ユーザーが提示した設計書のゴールを確認し、改めて【それを実際に発言する】
5. ゴールにたどり着くために必要な、関連するソースコードやドキュメントを全部読む
    - **ドキュメントを鵜呑みにせず、必ずソースコードを読む**
6. ソースコードの変更方針を言語化して【それを実際に発言する】
7. ソースコードを実際に修正する。【それを実際に発言する】
8. `bun run typecheck` で型エラーをすべて取り除く
9. `bun run test` でユニットテストエラーをすべて取く
10. ソースコードを改めて確認する。編集によって生じた無駄が無いか？
    - **無駄がある場合は、必ず4へ戻る**
11. 設計書に書いてあるすべての実装・動作確認が完了していないなら4へ戻る

## デバッグ方法

- ロガーを活用すること
- 一発で正常に動かない、修正できない場合は「バグ状態」である。その場合【それを実際に発言する】
-   **ダミーコードや未実装のコードが原因でテストや動作確認が失敗していないか、常に疑うこと。**
-   バグ状態を検出したら必ず `debug/YYYYMMDD-subject.md` を書く

例:
```md
# 症状の要約
resources/list で -32603

# 関連するデータ
terminal output:
resource is confilict.

# 仮説
余分なresource定義があるのではないか？ **あるいは、関連する機能がダミー実装のままになっているのではないか？**

# 関連するソースコード
src/index.ts
src/path/to/related/feature.ts

# 調査項目
- [ ] src/index.ts に余分なresource定義がないか確認する
- [ ] `src/path/to/related/feature.ts` が完全に実装されているか、ダミーコードが含まれていないか確認する
```

## デバッグ指針

-   スタックトレースは全文確認する
-   同一の現象が3回連続したら
    -   debug/YYYYMMDD-auto.md に実行したことを、箇条書きで要点をまとめて追記
    -   debug/YYYYMMDD-auto.md に変化したことを、箇条書きで要点をまとめて追記
    -   これまでの仮説に “原因誤認フラグ” を立てる
    -   「関連するデータ」から確認し直して、新たな仮説を立てる
-   SDK バグを疑う前に必ずチェック:
    -   登録漏れ
    -   callbacks 未設定
    -   型不一致
    -   **機能の未実装・ダミー実装**
-   迂回のための CLI 機能追加は禁止。根本修正完了までやりきる
